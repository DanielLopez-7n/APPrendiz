{% extends 'core/base_aprendiz.html' %}

{% block title %}Detalle Bitácora {{ bitacora.numero_bitacora }}{% endblock %}

{% block content %}
<div class="container py-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'aprendices:perfil_aprendiz' %}" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="bi bi-arrow-left me-2"></i>Volver al Dashboard
        </a>
        
        {% if bitacora.estado == 'Evaluada' or bitacora.estado == 'Aprobada' %}
            <span class="badge bg-success fs-5 px-4 py-2 rounded-pill shadow-sm">
                <i class="bi bi-check-circle-fill me-2"></i>Evaluada
            </span>
        {% elif bitacora.estado == 'Rechazada' %}
            <span class="badge bg-danger fs-5 px-4 py-2 rounded-pill shadow-sm">
                <i class="bi bi-x-circle-fill me-2"></i>Rechazada
            </span>
        {% else %}
            <span class="badge bg-secondary fs-5 px-4 py-2 rounded-pill shadow-sm">
                <i class="bi bi-clock-fill me-2"></i>Pendiente
            </span>
        {% endif %}
    </div>

    <div class="card shadow border-0 overflow-hidden">
        
        <div class="card-header bg-primary text-white p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="text-white-50 text-uppercase mb-1">Formato GFPI-F-147 V5</h5>
                    <h2 class="fw-bold mb-0">Bitácora N° {{ bitacora.numero_bitacora }}</h2>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="bg-white bg-opacity-25 p-2 rounded">
                        <small class="d-block text-white">Período Reportado</small>
                        <span class="fw-bold fs-5">{{ bitacora.fecha_inicio|date:"d M Y" }} - {{ bitacora.fecha_fin|date:"d M Y" }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body p-4 p-md-5">

            <h5 class="text-primary border-bottom pb-2 mb-4 fw-bold">
                <i class="bi bi-building me-2"></i>Datos del Ente Co-Formador
            </h5>
            
            <div class="row g-4 mb-5">
                <div class="col-md-6">
                    <label class="text-muted small fw-bold text-uppercase">Empresa / Razón Social</label>
                    <p class="fs-5 fw-medium text-dark">{{ bitacora.razon_social_empresa }}</p>
                </div>
                <div class="col-md-3">
                    <label class="text-muted small fw-bold text-uppercase">NIT</label>
                    <p class="fs-5 text-dark">{{ bitacora.nit_empresa }}</p>
                </div>
                <div class="col-md-3">
                    <label class="text-muted small fw-bold text-uppercase">Instructor Asignado</label>
                    <p class="fs-5 text-dark">{{ bitacora.instructor_seguimiento.usuario.get_full_name|default:"Sin asignar" }}</p>
                </div>
                
                <div class="col-12"><hr class="text-muted opacity-10"></div>

                <div class="col-md-4">
                    <label class="text-muted small fw-bold text-uppercase">Jefe Inmediato</label>
                    <p class="fs-5 text-dark">{{ bitacora.nombre_jefe_inmediato }}</p>
                </div>
                <div class="col-md-4">
                    <label class="text-muted small fw-bold text-uppercase">Cargo</label>
                    <p class="fs-5 text-dark">{{ bitacora.cargo_jefe }}</p>
                </div>
                <div class="col-md-4">
                    <label class="text-muted small fw-bold text-uppercase">Contacto</label>
                    <p class="mb-0"><i class="bi bi-envelope me-2"></i>{{ bitacora.email_jefe }}</p>
                    <p class="mb-0"><i class="bi bi-telephone me-2"></i>{{ bitacora.telefono_jefe }}</p>
                </div>
            </div>

            <h5 class="text-primary border-bottom pb-2 mb-4 fw-bold">
                <i class="bi bi-shield-check me-2"></i>Seguridad y Modalidad
            </h5>

            <div class="row g-4 mb-5 p-3 bg-light rounded border">
                <div class="col-md-3">
                    <label class="text-muted small fw-bold">Modalidad</label>
                    <p class="fw-bold text-dark">{{ bitacora.modalidad }}</p>
                </div>
                <div class="col-md-3">
                    <label class="text-muted small fw-bold">Afiliado ARL</label>
                    <p class="fw-bold {% if bitacora.afiliado_arl == 'SI' %}text-success{% else %}text-danger{% endif %}">
                        {{ bitacora.get_afiliado_arl_display }}
                    </p>
                </div>
                <div class="col-md-3">
                    <label class="text-muted small fw-bold">Nivel Riesgo</label>
                    <span class="badge bg-warning text-dark">{{ bitacora.get_nivel_riesgo_display }}</span>
                </div>
                <div class="col-md-3">
                    <label class="text-muted small fw-bold">Uso de EPP</label>
                    <p class="fw-bold">{{ bitacora.get_uso_epp_display }}</p>
                </div>
            </div>

            <h5 class="text-primary border-bottom pb-2 mb-4 fw-bold">
                <i class="bi bi-list-task me-2"></i>Descripción de Actividades
            </h5>

            <div class="p-4 bg-white border rounded shadow-sm mb-4">
                <p class="mb-0" style="white-space: pre-line; font-size: 1.05rem; line-height: 1.6;">{{ bitacora.descripcion_actividades }}</p>
            </div>

            <div class="d-flex align-items-center mb-5">
                <div class="me-3">
                    <i class="bi bi-paperclip fs-3 text-secondary"></i>
                </div>
                <div>
                    <h6 class="fw-bold mb-1">Evidencia Adjunta</h6>
                    {% if bitacora.archivo_evidencia %}
                        <a href="{{ bitacora.archivo_evidencia.url }}" target="_blank" class="text-decoration-none text-primary fw-bold">
                            Ver archivo adjunto <i class="bi bi-box-arrow-up-right ms-1"></i>
                        </a>
                    {% else %}
                        <span class="text-muted fst-italic">No se adjuntaron archivos.</span>
                    {% endif %}
                </div>
            </div>

            {% if bitacora.observaciones_instructor %}
                <div class="alert alert-warning border-warning shadow-sm mt-5">
                    <h5 class="alert-heading fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i>Observaciones del Instructor</h5>
                    <hr>
                    <p class="mb-0">{{ bitacora.observaciones_instructor }}</p>
                </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}